<!doctype html>
<html class="no-js" lang="fr-FR">

<head>
    <meta charset="utf-8">
    <title>Carte des expérimentations 5G&nbsp;&mdash Arcep</title>
    <meta name="description"
        content="Pour permettre à l'ensemble des acteurs innovants, industriels et acteurs « verticaux » de s'approprier les technologies liées à la 5G ainsi que les nouveaux cas d'usage qu'elle permet, et bénéficier de retours d'expérience variés, l'Arcep a ouvert deux guichets d'expérimentations, l'un en bande 3,8 - 4,0 GHz et l'autre en bande 26 GHz. Ils permettent aux acteurs intéressés de faire des demandes à l'Arcep d'autorisations d'utilisation de fréquences dans un cadre plus souple, à titre transitoire et dans la limite de leur disponibilité. Cette carte présente de manière synthétique les expérimentations en cours ou achevées">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta property="og:title" content="Carte des expérimentations 5G&nbsp;&mdash Arcep">
    <meta property="og:type" content="website">
    <meta property="og:url" content=""> <!-- TODO -->
    <meta property="og:image" content=""> <!-- TODO -->

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">

    <meta name="theme-color" content="#fafafa">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://www.unpkg.com/papaparse@5.4.1/papaparse.min.js"
        integrity="sha384-D/t0ZMqQW31H3az8ktEiNb39wyKnS82iFY52QPACM+IjKW3jDUhyIgh2PApRqJZs"
        crossorigin="anonymous"></script>
</head>

<body>

    <div id="map"></div>

    <script lang="js">
        let map = L.map('map', { attributionControl: false }).setView([47, 2], 6);
        L.control.attribution({ prefix: 'Leaflet' }).addTo(map);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank" title="les contributeurs OpenStreeMap">OpenStreetMap</a>',
        }).addTo(map);

        detailsExperimentation = function (data) {
            // console.log(typeof(data), data);
            let details = `<div class="details">
                <h2>TODO</h2><!-- TODO : où je trouve la localisation ? -->`
            let technos = Object.entries(data)
                .filter(([k, v]) => k.startsWith("Techno - ") && data[k] > 0)
                .reduce((acc, [k, v]) => `<li>${k.substring(9)}</li > `, "") // TODO gérer les images et le style des listes
            if (technos) {
                details = `${details} <ul class="technos">${technos}</ul>`
            }
            details = `${details}</div>`
            return details
        }

        HEADER_EXPERIMENTATEUR = "Expérimentateur"
        HEADER_FREQUENCES = "Fréquences utilisées"
        const results = Papa.parse('https://object.files.data.gouv.fr/arcep/experimentations-5G/experimentations_5G.csv', { // TODO extraire l'URL
            header: true,
            download: true,
            dynamicTyping: true,
            step: function (results, parser) {
                const r = results.data
                if (r.Latitude && r.Longitude && Number.isFinite(r.Latitude) && Number.isFinite(r.Longitude)) {
                    L.marker([r.Latitude, r.Longitude], {
                        title: `${r[HEADER_EXPERIMENTATEUR]} - ${r[HEADER_FREQUENCES]}`,
                    })
                        .bindPopup(detailsExperimentation(r))
                        .addTo(map);
                }
            }
        });
    </script>

</body>

</html>